<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="dashboardSuporte.css">
  <link rel="shortcut icon" href="./assets/logo.png" type="image/x-icon">
  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Dashboard | Home</title>
</head>

<body onload="obterDadosGrafico()">
  <section class="navbar">
    <div class="logo">
      <img src="assets/logo.png" alt="">
    </div>
    <nav>
      <li><a href="">
          <img src="assets/casa.png" alt="">
        </a></li>
    </nav>
    <div class="logout">
      <li><a href="../login.html">
          <img src="assets/sair.png" alt="">
        </a></li>
    </div>
  </section>

  <main>
    <section class="sectionPerfil" onclick="entrarPerfil()">
      <div class="containerPerfil">
        <div class="contentImage" id="imageUser">

        </div>
        <div class="contentName">
          <p id="nameUser">Marcelo A.</p>
        </div>
      </div>
    </section>
    <section class="sectionKPI">
      <div class="GroupKPI">
        <div class="containerKPI">
          <img src="assets/cpu-do-computador.png" alt="">
          <div class="contentHorizontal">
            <h1>CPU</h1>
          </div>
          <div class="contentVertical">
            <p>% de utilização</p>
          </div>
          <div class="contentVerticalParametro">
            <p id="dadosCpu"><span>%</span></p>
          </div>
        </div>
        <div class="containerGrafico">
          <div class="contentGrafico">
            <canvas id="kpi"></canvas>
          </div>
        </div>
        <div class="containerKPI">
          <img src="assets/cartao-de-memoria.png" alt="">
          <div class="containerKPI1">
            <div class="contentHorizontal">
              <!-- <img src="assets/cpu-do-computador.png" alt=""> -->
              <h1>Memória</h1>
            </div>
            <div class="contentVertical">
              <p>% de utilização</p>
            </div>
            <div class="contentVerticalParametro">
              <p id="dadosMemoria"><span>%</span></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="sectionTelas">
      <div class="primeiroGrupo">
        <div onclick="tela1()" class="containerTela" style=" border-bottom: red 5px solid;" id="card c1">
          <p class="date">Dezembro 20, 2021</p>
          <div class="contentVerticalTelas">
            <h1>Máquina 1</h1>
          </div>
          <p class="hours">09:25</p>
        </div>
        <div onclick="tela2()" class="containerTela" style=" border-bottom: red 5px solid;" id="card c2">
          <p class="date">Dezembro 20, 2021</p>
          <div class="contentVerticalTelas">
            <h1>Máquina 2</h1>
          </div>
          <p class="hours">09:25</p>
        </div>
        <div onclick="tela3()" class="containerTela" style=" border-bottom: red 5px solid;" id="card c3">
          <p class="date">Dezembro 20, 2021</p>
          <div class="contentVerticalTelas">
            <h1>Máquina 3</h1>
          </div>
          <p class="hours">09:25</p>
        </div>
        <div onclick="tela4()" class="containerTela" style=" border-bottom: red 5px solid;" id="card c4">
          <p class="date">Dezembro 20, 2021</p>
          <div class="contentVerticalTelas">
            <h1>Máquina 4</h1>
          </div>
          <p class="hours">09:25</p>
        </div>
      </div>
    </section>
  </main>
</body>

</html>

<script>
  // Gráfico KPI
  window.onload = function () {
    obterDadosGrafico(1);
    obterDadosGrafico(2);
    obterDadosGrafico(3);
    obterDadosGrafico(4);
  };

  function obterDadosGrafico(idNotebook) {
    fetch(`/medidas/tempo-real/${idNotebook}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  function tela1(idNotebook) {
    fetch(`/medidas/tela1/${idNotebook}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          if (json.length > 0) {
          var ultimaMedida = json[0];
          var porcentagemUsoMemoria = ultimaMedida.porcentagemUsoMemoria;
          var porcentagemUsoProcessador = ultimaMedida.porcentagemUsoProcessador;
          var dadosCpu = document.getElementById('dadosCpu');
          var dadosMemoria = document.getElementById('dadosMemoria');

          dadosCpu.innerHTML = ultimaMedida;
          dadosMemoria.innerHTML = ultimaMedida;
          }
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }
</script>